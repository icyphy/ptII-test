<?xml version="1.0" standalone="yes"?>
<!DOCTYPE doc PUBLIC "-//UC Berkeley//DTD DocML 1//EN"
    "http://ptolemy.eecs.berkeley.edu/xml/dtd/DocML_1.dtd">
<doc name="CollisionDetector" class="ptolemy.domains.wireless.lib.CollisionDetector">
  <description>
This actor models a typical physical layer front end of a wireless&#10; receiver. It models a receiver where messages have a non-zero duration&#10; and messages can collide with one another, causing a failure to receive.&#10; A message is provided to this actor at the time corresponding to the&#10; start of its transmission. Along with the message (an arbitrary&#10; token), the inputs must provide the duration of the message and its&#10; power.  The message spans an interval of time starting when it is&#10; provided to this actor and ending at that time plus the duration.&#10; If another message overlaps with a given message and has sufficient&#10; power, then the given message will be sent to the &lt;i&gt;collided&lt;/i&gt;&#10; output.  Otherwise it is sent to the &lt;i&gt;received&lt;/i&gt; output. In both&#10; cases, the message appears at the corresponding output at the time&#10; it is received plus the duration (i.e. the time at which the message&#10; has been completed).&#10; &lt;p&gt;&#10; The inputs are:&#10; &lt;ul&gt;&#10; &lt;li&gt; &lt;i&gt;message&lt;/i&gt;: The message carried by each transmission.&#10; &lt;li&gt; &lt;i&gt;power&lt;/i&gt;: The power of the received signal at the&#10; location of this receiver.&#10; &lt;li&gt; &lt;i&gt;duration&lt;/i&gt;: The time duration of the transmission.&#10; &lt;/ul&gt;&#10; The power and duration are typically delivered by the channel&#10; in the &quot;properties&quot; field of the transmission. The power&#10; is usually given as a power density (per unit area) so that&#10; a receiver can multiply it by its antenna area to determine&#10; the received power. It is in a linear scale (vs. DB), typically with&#10; units such as watts per square meter.  The duration is a&#10; non-negative double, and the message is an arbitrary token.&#10; &lt;p&gt;&#10; The outputs are:&#10; &lt;ul&gt;&#10; &lt;li&gt; &lt;i&gt;received&lt;/i&gt;: The message received. This port produces&#10; an output only if the received power is sufficient&#10; and there are no collisions.  The output is produced at a&#10; time equal to the time this actor receives the message plus&#10; the value received on the &lt;i&gt;duration&lt;/i&gt; input.&#10; &lt;li&gt; &lt;i&gt;collided&lt;/i&gt;: The message discarded. This port produces&#10; an output only if the received message collides with another&#10; message of sufficient power.  The output is produced at a&#10; time equal to the time this actor receives the message plus&#10; the value received on the &lt;i&gt;duration&lt;/i&gt; input.  The value&#10; of the output is the message that cannot be received.&#10; &lt;/ul&gt;&#10; &lt;p&gt;&#10; This actor is typically used with a channel that delivers a properties&#10; record token that contains &lt;i&gt;power&lt;/i&gt; and &lt;i&gt;duration&lt;/i&gt; fields.&#10; These fields can be extracted by using a GetProperties actor followed&#10; by a RecordDisassembler. The PowerLossChannel, for example, can be used.&#10; However, in order for the type constraints to be satisfied, the&#10; PowerLossChannel's &lt;i&gt;defaultProperties&lt;/i&gt; parameter must be&#10; augmented with a default value for the &lt;i&gt;duration&lt;/i&gt;.&#10; Each transmitter can override that default with its own message&#10; duration and transmit power.&#10; &lt;p&gt;&#10; Any message whose power (as specified at the &lt;i&gt;power&lt;/i&gt; input)&#10; is less than the value of the &lt;i&gt;powerThreshold&lt;/i&gt; parameter&#10; is ignored. It will not cause collisions and is not produced&#10; at the &lt;i&gt;collided&lt;/i&gt; output.  The &lt;i&gt;powerThreshold&lt;/i&gt; parameter&#10; thus specifies the power level at which the receiver simply fails&#10; to detect the signal.  It is given in a linear scale (vs. DB) with&#10; the same units as the &lt;i&gt;power&lt;/i&gt; input. The default value is zero,&#10; i.e. by default it won't ignore any received signal.&#10; &lt;p&gt;&#10; Any message whose power exceeds &lt;i&gt;powerThreshold&lt;/i&gt; has the&#10; potential of being successfully received, of failing to be&#10; received due to a collision, and of causing a collision.&#10; A message is successfully received if throughout its duration,&#10; its power exceeds the sum of all other message powers&#10; by at least &lt;i&gt;SNRThresholdInDB&lt;/i&gt; (which as the name&#10; suggests, is given in decibels, rather than in a linear&#10; scale, as is customary for power ratios).  Formally, let the&#10; message power for the &lt;i&gt;i&lt;/i&gt;-th message be&#10; &lt;i&gt;p&lt;/i&gt;&lt;sub&gt;&lt;i&gt;i&lt;/i&gt;&lt;/sub&gt;(&lt;i&gt;t&lt;/i&gt;) at time &lt;i&gt;t&lt;/i&gt;.&#10; Before the message is received and after its duration&#10; expires, this power is zero.  The &lt;i&gt;i&lt;/i&gt;-th message&#10; is successfully received if&#10; &lt;blockquote&gt;&#10; &lt;i&gt;p&lt;/i&gt;&lt;sub&gt;&lt;i&gt;i&lt;/i&gt;&lt;/sub&gt;(&lt;i&gt;t&lt;/i&gt;) &amp;ge; &lt;i&gt;P&lt;/i&gt;&#10; &amp;Sigma;&lt;sub&gt;(&lt;i&gt;j&lt;/i&gt; != &lt;i&gt;i&lt;/i&gt;)&lt;/sub&gt;&#10; &lt;i&gt;p&lt;/i&gt;&lt;sub&gt;&lt;i&gt;j&lt;/i&gt;&lt;/sub&gt;(&lt;i&gt;t&lt;/i&gt;)&#10; &lt;/blockquote&gt;&#10; for all &lt;i&gt;t&lt;/i&gt; where &lt;i&gt;p&lt;/i&gt;&lt;sub&gt;&lt;i&gt;i&lt;/i&gt;&lt;/sub&gt;(&lt;i&gt;t&lt;/i&gt;) &amp;gt; 0,&#10; where&#10; &lt;blockquote&gt;&#10; &lt;i&gt;P&lt;/i&gt; = 10^(&lt;i&gt;SNRThresholdInDB&lt;/i&gt;/10)&#10; &lt;/blockquote&gt;&#10; which is the signal to interference ratio in a linear scale.&#10; &lt;p&gt;&#10; The way this actor works is that each input that has sufficient power&#10; is recorded in a hash table indexed by the time at which its duration&#10; expires. In addition, the director is requested to fire this actor at&#10; that time.  Any time a message arrives, the actor checks for collisions,&#10; and marks any message subjected to a collision by this arrival.&#10; When the duration expires, the message is produced on one of the&#10; two outputs depending on whether it is marked as having encountered&#10; a collision, and it is removed from the hash table.&#10; &lt;p&gt;&#10; NOTE: This actor assumes that the duration of messages is short&#10; relative to the rate at which the actors move. That is, the received&#10; power (and whether a receiver is in range) is determined once, at the&#10; time the message starts, and remains constant throughout the transmission.&#10; It also requires that all three inputs have tokens when fired.  </description>
  <author>Yang Zhao, Xiaojun Liu, Edward Lee</author>
  <version>$Id$</version>
  <since>Ptolemy II 4.0</since>
  <Pt.ProposedRating>Green (cxh)</Pt.ProposedRating>
  <Pt.AcceptedRating>Yellow (cxh)</Pt.AcceptedRating>
    <!--ptolemy.actor.TypedIOPort-->
    <port name="message">The input port for the message.  This has undeclared type.</port>
    <!--ptolemy.actor.TypedIOPort-->
    <port name="power">The input port for power. This has type double, and is typically&#10;  a power density, in units such as watts per square meter.</port>
    <!--ptolemy.actor.TypedIOPort-->
    <port name="duration">The input port for the time that a message transmission takes.&#10;  This has type double.</port>
    <!--ptolemy.actor.TypedIOPort-->
    <port name="received">The output port that produces messages that are successfully&#10;  received. This has the same type as the message input.</port>
    <!--ptolemy.actor.TypedIOPort-->
    <port name="collided">The output port that produces messages that cannot be&#10;  received because of a collision. This has the same type as the&#10;  message input.</port>
    <!--ptolemy.data.expr.Parameter-->
    <property name="SNRThresholdInDB">The threshold for the signal to be recognized from interference.&#10;  It is specified in decibels (10 * log&lt;sub&gt;10&lt;/sub&gt;(&lt;i&gt;r&lt;/i&gt;),&#10;  where &lt;i&gt;r&lt;/i&gt; is the power ratio.  This is a double that&#10;  defaults to Infinity, which indicates that all overlapping&#10;  messages are lost to collisions.</property>
    <!--ptolemy.data.expr.Parameter-->
    <property name="powerThreshold">The power threshold above which the signal can be&#10;  detected at the receiver. Any message with a received power&#10;  below this number is ignored.  This has type double&#10;  and defaults to 0.0, which indicates that all messages&#10;  (with nonzero power) will be received.</property>
</doc>
