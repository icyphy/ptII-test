<?xml version="1.0" standalone="yes"?>
<!DOCTYPE doc PUBLIC "-//UC Berkeley//DTD DocML 1//EN"
    "http://ptolemy.eecs.berkeley.edu/xml/dtd/DocML_1.dtd">
<doc name="AlgebraicLoopDirector" class="ptolemy.domains.algebraic.kernel.AlgebraicLoopDirector">
  <description>
A director for solving algebraic loops. This director initializes&#10; all inputs that have a defaultValue parameter, and then executes the model&#10; according to the specified solver method until all inputs change by less&#10; than a specified errorTolerance. The methods implemented are:&#10; &lt;ol&gt;&#10; &lt;li&gt; SuccessiveSubstitution: This simple strategy executes the model&#10; until all inputs have converge.&#10; &lt;li&gt; NewtonRaphson: The Newton-Raphson iteration.&#10; &lt;li&gt; Homotopy: A homotopy method that uses Newton-Raphson iteration and Euler&#10;      updates that search along a curve on which a linear approximation to the&#10;      problem is successively replaced with the actual function.&#10; &lt;/ol&gt;&#10; In all cases, the number of iterations is limited to &lt;i&gt;maxIterations&lt;/i&gt;,&#10; and an exception will be thrown if convergence hasn't occurred by then.&#10; &lt;p&gt;&#10; The errorTolerance may be given as a parameter to an individual port&#10; (just add a parameter named &quot;errorTolerance&quot; to the port). For any&#10; port for which there is no such parameter, the errorTolerance parameter&#10; of this director will be used. Note that if the errorTolerance of a port&#10; is changed during a run, the new value is ignored until the next run.&#10; &lt;p&gt;&#10; In all cases, the problem being solved has the form:&#10; &lt;pre&gt;&#10;     -----------&#10;     |  -----  |&#10;     --&amp;gt;| g |---&#10;     x  -----&#10; &lt;/pre&gt;&#10; where &lt;i&gt;x&lt;/i&gt; is initially the vector of values corresponding to input&#10; ports that have a non-null defaultValue parameter, and &lt;i&gt;g&lt;/i&gt; is the&#10; network of actors connecting these ports.&#10; &lt;p&gt;&#10; This class solves an algebraic loop of the form x=g(x)&#10; &lt;pre&gt;&#10;     -----------&#10;     |  -----  |&#10;     --&amp;gt;| g |---&#10;     x  -----&#10; &lt;/pre&gt;&#10; where &lt;i&gt;x&lt;/i&gt; is initially the vector of values corresponding to input&#10; ports that have a non-null defaultValue parameter, and &lt;i&gt;g&lt;/i&gt; is the&#10; network of actors connecting these ports.&#10; &lt;p&gt;&#10; For the SuccessiveSubstitution, we simply evaluate &lt;i&gt;g&lt;/i&gt; repeatedly&#10; until either all signals do not change by more than the errorTolerance,&#10; or until there have been &lt;i&gt;maxIterations&lt;/i&gt;. Note that it is possible&#10; to reach a fixed point where some or all signals are infinite.&#10; &lt;p&gt;&#10; For NewtonRaphson, we solve for g(x)=x by solving f(x)=0,&#10; where f(x) = x-g(x). This is done by iterating as follows:&#10; &lt;pre&gt;&#10;   x_n+1 = x_n - f(x_n)/f'(x_n) = x_n - (x_n - g(x_n))/(1 - g'(x_n)) .&#10; &lt;/pre&gt;&#10; To estimate g'(x_n), we do&#10; &lt;pre&gt;&#10;   g'(x_n) = (g(x_n + d) - g(x_n))/d&#10; &lt;/pre&gt;&#10; where &lt;i&gt;d&lt;/i&gt; is the &lt;i&gt;delta&lt;/i&gt; parameter.&#10; &lt;p&gt;&#10; For Homotopy, we solve f(x) = x - g(x).&#10; The problem is reformulated as H(s, lambda, x0) = s - lambda (g(s+x0)-x0),&#10; where lambda has an initial value of 0 and is successively increased to 1,&#10; s is a coordinate transformation defined so that x = s+x0, where&#10; x0 is the initial iterate.&#10; &lt;br&gt;&#10; The implementation is equal to Program 3 of&#10; Eugene L. Allgower and Kurt Georg,&#10; Introduction to Numerical Continuation Methods,&#10; Classics in Applied Mathematics, Vol. 45, SIAM, 2003.&#10; However, the implementation by Allgower and Georg assumes an initial iterate of 0,&#10; which is the reason for the above coordinate transformation.&#10; &lt;p&gt;&#10; FIXME: Questions:&#10; &lt;ul&gt;&#10; &lt;li&gt; This implementation checks for convergence of &lt;i&gt;all&lt;/i&gt; input&#10;      ports, not just those with defaultValue parameters (i.e., not just&#10;      &lt;i&gt;x&lt;/i&gt;). Is this what we want?&#10; &lt;li&gt; This implementation uses the defaultValue on every firing.&#10;      Should the default value instead be replaced by the previous&#10;      solution on all but the first iteration?&#10;      FIXME: Yes, this will need to be done as it increases robustness and efficiency.&#10; &lt;li&gt; Should delta be able to be different for each variable?&#10;      I.e., should each input port that has a defaultValue parameter&#10;      also be able to have a delta parameter?&#10;      FIXME: Yes, the magnitudes of variables can be a few orders of magnitude different,&#10;      e.g., if one port as a control signal, and another an air pressure in Pascal.&#10; &lt;li&gt; Instead of estimating g'(x_n), we want to be able to optionally&#10;      identify g'(x_n). But this is really tricky when x_n is a vector&#10;      (i.e. where there are multiple input ports with defaultValue).&#10;      FIXME: This is addressed in the Homotopy algorithm which uses Broyden updates&#10;      to estimate the Jacobian. A similar mechanism could be added to the Newton&#10;      algorithm in future work.&#10; &lt;li&gt; This code is not at all optimized and may be quite inefficient.&#10; &lt;/ul&gt;  </description>
  <author>Edward A. Lee and Michael Wetter</author>
  <version>$Id$</version>
  <since>Ptolemy II 10.0</since>
  <Pt.ProposedRating>Yellow (eal)</Pt.ProposedRating>
  <Pt.AcceptedRating>Red (pwhitake)</Pt.AcceptedRating>
    <!--ptolemy.data.expr.Parameter-->
    <property name="errorTolerance">The default tolerance for determining when convergence has occurred.&#10;  When the current value of an input port differs from the previous&#10;  value by less than the &lt;i&gt;errorTolerance&lt;/i&gt;, then we declare it to&#10;  hfave converged. This parameter gives a default value that will be used&#10;  if the port has no parameter named &quot;errorTolerance&quot;. This is a&#10;  double with default value 1E-4.</property>
    <!--ptolemy.data.expr.Parameter-->
    <property name="maxIterations">The maximum number of allowed iterations before the director&#10;  will declare a failure to converge. This is an integer that defaults&#10;  to 1000.</property>
    <!--ptolemy.data.expr.StringParameter-->
    <property name="method">The method to be used to solve algebraic loops. This is a string&#10;  that is one of &quot;Homotopy&quot; (the default), &quot;NewtonRaphson&quot; or &quot;SuccessiveSubstitution&quot;.</property>
</doc>
